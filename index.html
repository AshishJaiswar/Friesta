<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friesta | Homepage</title>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./pages/styles/modal.css">
    <script src="./scripts/jquery.min.js"></script>
    <link rel="stylesheet" href="./pages/styles/home.css">


</head>

<body>
    <div class="header">
        <div class="logo">
            <a href="#">
                <h1 id="friesta">Friesta</h1>
            </a>
        </div>
        <div class="search">
            <input type="text" placeholder="Search" class="search-input">
            <button type="submit">Search</button>
        </div>
        <div class="nav-links">
            <ul class="links">
                <li><a href="#">Home</a></li>
                <li><a href="#">Chats</a></li>
                <li><a href="#">Notifications</a></li>
                <li><a href="#">My Profile</a></li>
            </ul>
        </div>
    </div>
    <div class="container">
        <div class="detail">

        </div>
        <div class="posts">
            <div class="create-post">
                <div class="post-area">
                    <textarea class="textarea" type="text" placeholder="What are you thinking?" rows="5"
                        cols="80"></textarea>
                    <div class="post-button">
                        <button type="submit" id="post">Post</button>

                        <div class="select">
                            <input type="file" hidden="hidden" id="real-file">
                            <input type="text" class="browse" placeholder="Upload Image" id="custom-text">
                            <button type="button" class="choose" id="custom-button">Choose image</button>
                        </div>

                    </div>

                </div>

            </div>
            <div class="timeline">

            </div>
            <div class="modal fade" role="dialog" tabindex="-1">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Comments</h4>
                        </div>
                        <div class="modal-body" style="max-height: 400px; overflow-y: auto">
                            <p>The content of your modal.</p>
                        </div>
                        <div class="modal-footer"><button class="btn btn-light" type="button"
                                data-dismiss="modal">Close</button></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="people">

        </div>
</body>
</div>
<script type="text/javascript">
    const realFileBtn = document.getElementById("real-file");
    const customBtn = document.getElementById("custom-button");
    const customTxt = document.getElementById("custom-text");

    customBtn.addEventListener("click", function () {
        realFileBtn.click();
    });


    realFileBtn.addEventListener("change", function () {
        if (realFileBtn.value) {
            customTxt.value = realFileBtn.value.match(
                /[\/\\]([\w\d\s\.\-\(\)]+)$/
            )[1];
        } else {
            customTxt.value = "No file chosen, yet.";
        }
    });
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: 'index.php',
            processData: false,
            contentType: 'application/json',
            data: '',
            success: function (data) {
                var posts = JSON.parse(data)
                $.each(posts, function (index) {
                    var d = new Date(posts[index].PostDate);
                    timeline = '<div class="user-posts"><div class="username">\
                        <div class="profile-logo">\
                            <img src="#">\
                        </div>\
                        <h3 class="user_name"><a id="user-link" href="profile.php?username='+ posts[index].PostedBy + '">' + posts[index].PostedBy + '</a></h3>\
                    </div>\
                    <div class="time">\
                        <p class="post-time">'+ d.toDateString() + '</p>\
                    </div>\
                    <div class="posted-area">\
                        <p> '+ posts[index].PostBody + '\
                        </p>\
                    </div>\
                    <div class="like-comment">\
                        <div class="like">\
                            <div class="heart" data-id="'+ posts[index].PostId + '">\
                                <p class="like-number">'+ posts[index].Likes + '</p>\
                            </div>\
                        </div>\
                        <div class="comment"  data-postid="'+ posts[index].PostId + '" >\
                            <img class="comment-icon" src="./pages/images/flash.svg">\
                            <span class="comment-btn">comments</span>\
                        </div>\
                    </div>\
                    <div class="display" style="display: none;">\
                      <input class="input-comment" type="text" placeholder="Add Comment"> <span><button>Comment</button></span>\
                      <div class="posted-comment">\
                        <p ><b>_ashish_jaiswar_ ~</b> <span>Nice Post</span></p>\
                      </div>\
                </div>'
                    $('.timeline').html(
                        $('.timeline').html() + timeline
                    )

                    $('[data-postid]').click(function () {
                        var buttonid = $(this).attr('data-postid');
                        $.ajax({
                            type: "GET",
                            url: "api/comments?postid=" + $(this).attr('data-postid'),
                            processData: false,
                            contentType: "application/json",
                            data: '',
                            success: function (r) {
                                var res = JSON.parse(r)
                                showCommentsModal(res);

                            },
                            error: function (r) {
                                console.log(r)
                            }
                        });
                    });

                    $('[data-id]').click(function () {

                        var buttonid = $(this).attr('data-id');
                        $.ajax({
                            type: "POST",
                            url: "api/likes?id=" + $(this).attr('data-id'),
                            processData: false,
                            contentType: "application/json",
                            data: '',
                            success: function (r) {
                                var res = JSON.parse(r)
                                $("[data-id='" + buttonid + "']").html('<p class="like-number">' + res.Likes + '</p>')
                            },
                            error: function (r) {
                                console.log(r)
                            }
                        });
                    })
                })
            },
            error: function (data) {
                console.log(data)
            }
        })
    })
    function showCommentsModal(res) {
        $('.modal').modal('show')
        var output = "";
        for (var i = 0; i < res.length; i++) {
            output += res[i].Comment;
            output += " ~ ";
            output += res[i].CommentedBy;
            output += "<hr />";
        }
        $('.modal-body').html(output)
    }
</script>

<script src="assets/bootstrap/js/bootstrap.min.js"></script>

</html>